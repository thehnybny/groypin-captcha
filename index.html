<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Turnstile</title>
    <style>
      body { margin:0; padding:16px; font-family: system-ui, sans-serif; }
      #cf { display:flex; justify-content:center; margin-top:12px; }
      .hint { font-size:14px; opacity:.7; text-align:center; }
    </style>

    <script>
      // Read params first so the onload handler can use them.
      const params  = new URLSearchParams(location.search);
      const sitekey = params.get('sitekey');
      const action  = params.get('action') || 'signin';

      function done(token) {
        if (window.TokenChannel && window.TokenChannel.postMessage) {
          window.TokenChannel.postMessage(token);
        } else {
          location.href = 'turnstile://token/' + encodeURIComponent(token);
        }
      }
      function fail() {
        if (window.TokenChannel && window.TokenChannel.postMessage) {
          window.TokenChannel.postMessage('');
        } else {
          location.href = 'turnstile://token/';
        }
      }

      // Called by the Turnstile script once it has loaded.
      function onloadTurnstileCallback() {
        const wid = turnstile.render('#cf', {
          sitekey,
          action,
          size: 'auto',
          theme: 'auto',
          callback: done,
          'error-callback': fail,
          'timeout-callback': fail,
          retry: 'auto',
        });
        try { turnstile.execute(wid); } catch (e) {}
      }
    </script>

    <!-- Load Turnstile and invoke our onload handler when it's ready -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback" async defer></script>
  </head>
  <body>
    <div class="hint">Completing verificationâ€¦</div>
    <div id="cf"></div>
  </body>
</html>
